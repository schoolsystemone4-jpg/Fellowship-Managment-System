generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Gender {
  MALE
  FEMALE
}

enum ServiceType {
  TUESDAY_FELLOWSHIP
  THURSDAY_PHANEROO
}

enum CheckInMethod {
  QR
  MANUAL
}

enum TransportStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum Role {
  MEMBER
  FELLOWSHIP_MANAGER
}

model Member {
  id               String   @id @default(uuid())
  fullName         String
  email            String   @unique
  phoneNumber      String
  password         String
  role             Role     @default(MEMBER)
  fellowshipNumber String   @unique
  gender           Gender
  residence        String?
  course           String?
  yearOfStudy      Int?
  qrCode           String   @unique @default(uuid())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  attendances       Attendance[]
  transportBookings TransportBooking[]

  @@index([phoneNumber])
  @@index([email])
  @@index([fellowshipNumber])
}

model Event {
  id                String      @id @default(uuid())
  name              String
  date              DateTime
  startTime         String // Format: "HH:MM"
  endTime           String // Format: "HH:MM"
  type              ServiceType
  venue             String?
  isRecurring       Boolean     @default(false)
  recurrenceRule    String? // DAILY, WEEKLY, MONTHLY
  isActive          Boolean     @default(false)
  allowGuestCheckin Boolean     @default(false)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  attendances       Attendance[]
  guestAttendances  GuestAttendance[]
  transportBookings TransportBooking[]

  @@index([date])
  @@index([isActive])
}

model Attendance {
  id          String        @id @default(uuid())
  memberId    String
  eventId     String
  method      CheckInMethod
  checkedInAt DateTime      @default(now())

  member Member @relation(fields: [memberId], references: [id])
  event  Event  @relation(fields: [eventId], references: [id])

  @@unique([memberId, eventId])
}

model TransportBooking {
  id          String          @id @default(uuid())
  memberId    String
  eventId     String
  pickupPoint String
  status      TransportStatus @default(PENDING)
  bookedAt    DateTime        @default(now())

  member Member @relation(fields: [memberId], references: [id])
  event  Event  @relation(fields: [eventId], references: [id])

  @@unique([memberId, eventId])
}

model GuestAttendance {
  id          String   @id @default(uuid())
  eventId     String
  guestName   String
  guestPhone  String?
  purpose     String?
  checkedInAt DateTime @default(now())

  event Event @relation(fields: [eventId], references: [id])
}
